<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Memory F1 - 20 Paires</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
</head>
<body>

<div id="header">
  <div id="infoCoups">Coups: 0</div>
  <div class="header-center">
    <button id="restartBtn" title="Rejouer">Rejouer</button>
    <button id="fullscreenBtn" title="Plein écran">🔲</button>
  </div>
  <div id="infoTemps">Temps: 0s</div>
</div>

<div id="game-parent"></div>

<script src="js/memory-game.js"></script>
<script>
  // Configuration du niveau 20 paires, 8 colonnes x 5 lignes
  const PAIRS = 20;
  const COLS = 8;
  const ROWS = 5;

  // Crée la config Phaser en passant les paramètres niveau
  function createConfig() {
    const parent = document.getElementById('game-parent');
    return {
      type: Phaser.AUTO,
      parent: 'game-parent',
      width: parent.clientWidth,
      height: parent.clientHeight,
      backgroundColor: '#243',
      scene: [MemoryScene],
      scale: { mode: Phaser.Scale.NONE, autoCenter: Phaser.Scale.CENTER_BOTH }
    };
  }

  // Instance globale du jeu
  let game;

  function startGame() {
    if (game) {
      game.destroy(true);
      document.getElementById('game-parent').innerHTML = '';
    }
    game = new Phaser.Game(createConfig());
    // Données à passer à la scène par événement custom
    game.events.once('ready', () => {
      game.scene.scenes[0].initGame(PAIRS, COLS, ROWS);
    });
  }

  window.onload = () => {
    startGame(); 

    // Bouton plein écran avec toggle complet
    const fsBtn = document.getElementById('fullscreenBtn');
    fsBtn.onclick = () => {
      if (!document.fullscreenElement) {
        // Demande plein écran
        document.documentElement.requestFullscreen?.()
        || document.documentElement.webkitRequestFullscreen?.()
        || document.documentElement.mozRequestFullScreen?.()
        || document.documentElement.msRequestFullscreen?.();
      } else {
        // Sortie du plein écran
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if(window.webkitExitFullscreen) {
          window.webkitExitFullscreen();
        } else if(window.mozCancelFullScreen) {
          window.mozCancelFullScreen();
        } else if(window.msExitFullscreen) {
          window.msExitFullscreen();
        }
      }
    };

    // Bouton rejouer — lance le jeu
    document.getElementById('restartBtn').onclick = () => {
      startGame();
    };
  };

  // Optional : repositionner ou resize le jeu lors du changement d'écran (fullscreen etc)
  window.addEventListener('resize', () => {
    if (game) {
      game.scale.resize(document.getElementById('game-parent').clientWidth, document.getElementById('game-parent').clientHeight);
      game.scene.scenes[0].resizeGame();
    }
  });

  // Support pour changer le titre du bouton plein-écran dynamiquement :  
  document.addEventListener('fullscreenchange', () => {
    const fsBtn = document.getElementById('fullscreenBtn');
    if (document.fullscreenElement) {
      fsBtn.title = 'Quitter le plein écran';
      fsBtn.textContent = '❎';  // Changer icône en croix par exemple
    } else {
      fsBtn.title = 'Plein écran';
      fsBtn.textContent = '🔲';
    }
  });
</script>
</body>
</html>
